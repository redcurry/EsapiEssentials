<Window
    x:Class="EsapiEssentials.PluginRunner.MainWindow"
    x:ClassModifier="internal"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    Title="ESAPI Essentials Plugin Runner"
    Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
    WindowStartupLocation="CenterScreen"
    Width="640" Height="640"
    >
    <DockPanel
        Margin="10"
        >

        <StackPanel
            Orientation="Horizontal"
            >
            <TextBlock
                Text="Search patient:"
                VerticalAlignment="Center"
                />
            <TextBox
                Name="SearchTextBox"
                Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged, NotifyOnSourceUpdated=True}"
                Width="150"
                Margin="5,0,0,0"
                >
                <!-- Call the SearchPatientCommand when the SearchText is updated in the view model -->
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="SourceUpdated">
                        <i:InvokeCommandAction Command="{Binding SearchPatientCommand}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </TextBox>
            <Button
                Content="Open"
                IsDefault="True"
                Command="{Binding OpenPatientCommand}"
                Margin="10,0,0,0"
                />
        </StackPanel>

        <ListBox
            DockPanel.Dock="Top"
            ItemsSource="{Binding PatientMatches}"
            >
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <TextBlock>
                        <Run Text="{Binding LastName}" />, <Run Text="{Binding FirstName}" /> (<Run Text="{Binding Id}" />)
                    </TextBlock>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

    </DockPanel>
</Window>
